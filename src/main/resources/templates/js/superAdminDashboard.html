<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head></head>
<body>
<th:block th:fragment="superAdminDashboard">
  <script type="text/javascript">
            let currentPage = 0;
             let pageSize = 5;
            let totalRecords = 0;
            let totalPages = 0;
        $(document).ready(function() {
          loadCompanies();

        $('#searchInput').on('input', function() {
            clearTimeout(window.searchTimeout);
            window.searchTimeout = setTimeout(function() {
                loadCompanies();
            }, 300);
        });

        $('#statusFilter').on('change', function() {
            loadCompanies();
        });
     });

     function loadCompanies() {
        const accessToken = $('#accessToken').val();
        const statusFilter = $('#statusFilter').val();
        const searchQuery = $('#searchInput').val().trim();

        $('#loadingSpinner').show();
        $('#companiesGrid').empty();
        $('#errorContainer').empty();

        let requestData = {
            filterVO: {
               pageNumber: currentPage,
               pageSize: pageSize,
               direction: 'DESC',
              }
        };

        if (statusFilter && statusFilter !== '' && statusFilter !== 'ALL') {
            requestData.companyStatus = statusFilter;
        }

        if (searchQuery && searchQuery.length > 0) {
            requestData.companyName = searchQuery;
        }
                 $('#loadingIndicator').show();
                 $('#companyTableContainer').hide();
        $.ajax({
            url: '/api/getAllCompanies',
            type: 'POST',
            headers: {
                'Authorization': 'Bearer ' + accessToken,
                'Content-Type': 'application/json'
            },
            contentType: 'application/json',
            data: JSON.stringify(requestData),
            success: function(response) {
                $('#loadingSpinner').hide();
                 $('#loadingIndicator').hide();
                 $('#companyTableContainer').show();
                if (response.status === 'SUCCESS') {
                    if (response.companyVos && response.companyVos.length > 0) {
                         totalRecords = response.totalRecords || 0;
                         totalPages = Math.ceil(totalRecords / pageSize);
                         updatePagination()
                        renderCompanies(response.companyVos);
                    } else {
                        showEmptyState();
                    }
                } else {
                    showError(response.errorMessage || 'Failed to load companies');
                }
            },
            error: function(xhr, status, error) {
                $('#loadingSpinner').hide();
                let errorMessage = 'Failed to load companies';

                if (xhr.status === 401) {
                    errorMessage = 'Unauthorized. Please check your authentication token.';
                } else if (xhr.status === 404) {
                    errorMessage = 'API endpoint not found.';
                } else if (xhr.responseJSON && xhr.responseJSON.errorMessage) {
                    errorMessage = xhr.responseJSON.errorMessage;
                }

                showError(errorMessage);
            }
        });
     }
     function goToPage(page) {
            if (page < 1 || page > totalPages || page === currentPage) {
                return;
            }

            currentPage = page;
            loadCompanies();
        }
     function changePageSize() {
                 const newPageSize = parseInt($('#pageSizeSelector').val());

                 if (newPageSize !== pageSize) {
                     pageSize = newPageSize;
                     currentPage = 0; // Reset to first page
                     loadCompanies();
                 }
             }
             function updatePagination() {
                 const paginationControls = $('#paginationControls');
                 const paginationInfo = $('#paginationInfo');

                let startRecord = 0;
                let endRecord = 0;

                if (totalRecords > 0) {
                startRecord = (currentPage * pageSize) + 1;
                endRecord = Math.min((currentPage + 1) * pageSize, totalRecords);
                paginationInfo.text(`Showing ${startRecord} - ${endRecord} of ${totalRecords} companies`);
            }

                 // Generate pagination buttons
                 let html = '';

                 // Previous button
                 html += `
                     <button class="page-btn" onclick="goToPage(${currentPage - 1})"
                             ${currentPage <= 1 ? 'disabled' : ''}>
                         Previous
                     </button>
                 `;

                 // Page number buttons
                 const maxVisiblePages = 5;
                 let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
                 let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

                 // Adjust start page if we're near the end
                 if (endPage - startPage + 1 < maxVisiblePages) {
                     startPage = Math.max(1, endPage - maxVisiblePages + 1);
                 }

                 // First page if not visible
                 if (startPage > 1) {
                     html += `<button class="page-btn" onclick="goToPage(1)">1</button>`;
                     if (startPage > 2) {
                         html += `<span class="page-btn" disabled>...</span>`;
                     }
                 }

                 // Page number buttons
                 for (let i = startPage; i <= endPage; i++) {
                     html += `
                         <button class="page-btn ${i === currentPage ? 'active' : ''}"
                                 onclick="goToPage(${i})">
                             ${i}
                         </button>
                     `;
                 }

                 // Last page if not visible
                 if (endPage < totalPages) {
                     if (endPage < totalPages - 1) {
                         html += `<span class="page-btn" disabled>...</span>`;
                     }
                     html += `<button class="page-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
                 }

                 // Next button
                 html += `
                     <button class="page-btn" onclick="goToPage(${currentPage + 1})"
                             ${currentPage >= totalPages ? 'disabled' : ''}>
                         Next
                     </button>
                 `;

                 paginationControls.html(html);
             }
     function renderCompanies(companies) {
        const companiesGrid = $('#companiesGrid');
        companiesGrid.empty();

        companies.forEach(function(company) {
            const companyCard = createCompanyCard(company);
            companiesGrid.append(companyCard);
        });
     }

      function createCompanyCard(company) {
        const statusClass = company.status === 'ACTIVE' ? 'bg-success' : 'bg-danger';
        const statusText = company.status || 'Unknown';
        const fullAddress = [
            company.addressName,
            company.city,
            company.state,
            company.country
        ].filter(Boolean).join(', ');
        const cardId = `company-card-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        const cardHtml = `
            <div class="col-md-6 col-lg-4 mb-4">
    <div class="card company-card h-100" id="${cardId}" data-company='${JSON.stringify(company).replace(/'/g, "&#39;")}'>
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="d-flex align-items-center">
                    <img src="${company.profilePicURL ? escapeHtml(company.profilePicURL) : 'https://placehold.co/600x400'}"
                         alt="Company Logo"
                         class="rounded-circle me-3"
                         style="width: 50px; height: 50px; object-fit: cover;"
                         onerror="this.src='https://via.placeholder.com/50x50/6c757d/ffffff?text=C'">
                    <h5 class="card-title mb-0">${escapeHtml(company.companyName || 'Unnamed Company')}</h5>
                </div>
                <span class="badge ${statusClass} status-badge">${escapeHtml(statusText)}</span>
            </div>
            ${company.subDomain ? `
            <div class="mb-3">
                <small class="text-muted">
                    <i class="fas fa-globe me-1"></i>
                    ${escapeHtml(company.subDomain)}
                </small>
            </div>
            ` : ''}
            ${fullAddress ? `
            <div class="mb-2">
                <small class="text-muted">
                    <i class="fas fa-map-marker-alt me-1"></i>
                    ${escapeHtml(fullAddress)}
                </small>
            </div>
            ` : ''}
            ${company.email ? `
            <div class="mb-2">
                <small class="text-muted">
                    <i class="fas fa-envelope me-1"></i>
                    ${escapeHtml(company.email)}
                </small>
            </div>
            ` : ''}
            ${company.phone ? `
            <div class="mb-3">
                <small class="text-muted">
                    <i class="fas fa-phone me-1"></i>
                    ${escapeHtml(company.phone)}
                </small>
            </div>
            ` : ''}
            <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" onclick="editCompany(getCompanyFromCard(this))" data-bs-target="#editCompanyModal">
                    <i class="fas fa-edit "></i>
                 </button>
                <button class="btn btn-outline-danger btn-sm" onclick="deleteCompany(getCompanyFromCard(this))">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="btn btn-outline-info btn-sm" onclick="viewCompany(getCompanyFromCard(this))">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
        </div>
    </div>
</div>
        `;

        return cardHtml;
     }
     function getCompanyFromCard(buttonElement) {
        const card = buttonElement.closest('.company-card');
        const companyData = card.getAttribute('data-company');
        return JSON.parse(companyData);
     }

     function showEmptyState() {
        const emptyStateHtml = `
            <div class="col-12">
                <div class="empty-state">
                    <i class="fas fa-building"></i>
                    <h4>No Companies Found</h4>
                    <p class="mb-0">There are no companies to display at the moment.</p>
                </div>
            </div>
        `;
        $('#companiesGrid').html(emptyStateHtml);
     }

     function showError(message) {
        const errorHtml = `
            <div class="error-message">
                <i class="fas fa-exclamation-triangle me-2"></i>
                ${escapeHtml(message)}
            </div>
        `;
        $('#errorContainer').html(errorHtml);
     }

     function escapeHtml(unsafe) {
        if (unsafe == null) return '';
        return unsafe
            .toString()
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
     }

     function editCompany(company) {
            resetForm();
            $('#companyName').val(company.companyName);
            $('#subDomain').val(company.subDomain);
            $('#addressName').val(company.addressName);
            $('#city').val(company.city);
            $('#state').val(company.state);
            $('#country').val(company.country);
            $('#email').val(company.email);
            $('#phone').val(company.phone);
            $('#status').val(company.status.toLowerCase());
            setTimeout(() => {
                $('#companyName').focus();
            }, 400);

     }
     function resetForm() {
            $('#editCompanyForm')[0].reset();
            $('.error-message').hide();
            $('#successMessage').hide();
            $('#saveButton').prop('disabled', false);
            $('.loading-spinner').hide();
            $('#saveButton').text('Update Company');
        }
     function closeEditModal() {
      $('#editCompanyModal').hide();
     }
        function validateForm() {
            let isValid = true;
            const requiredFields = ['companyName', 'subDomain', 'addressName', 'city', 'state', 'country', 'email', 'phone', 'status'];

            requiredFields.forEach(field => {
                const element = $('#' + field);
                const value = element.val().trim();

                if (!value) {
                    element.siblings('.error-message').show();
                    element.addClass('error');
                    isValid = false;
                } else {
                    element.siblings('.error-message').hide();
                    element.removeClass('error');
                }
            });

            // Email validation
            const email = $('#email').val().trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailRegex.test(email)) {
                $('#email').siblings('.error-message').text('Please enter a valid email address').show();
                $('#email').addClass('error');
                isValid = false;
            }

            return isValid;
        }
     $('#editCompanyForm').on('submit', function (e) {
      e.preventDefault();
        if (!validateForm()) {
                return;
            }
             $('#saveButton').prop('disabled', true);
            $('.loading-spinner').show();
            $('#saveButton').text('Updating...');
            const profilePicFile = document.getElementById('profilePic').files[0];
            if (!profilePicFile) {
                        $.ajax({
                            url: '/api/editCompany',
                            type: 'POST',
                            contentType: 'application/json',
                            headers: {
                                'Authorization': 'Bearer ' + getAccessToken()
                            },
                            data: JSON.stringify({
                                companyName: $('#companyName').val().trim(),
                                subDomain: $('#subDomain').val().trim(),
                                addressName: $('#addressName').val().trim(),
                                city: $('#city').val().trim(),
                                state: $('#state').val().trim(),
                                country: $('#country').val().trim(),
                                email: $('#email').val().trim(),
                                phone: $('#phone').val().trim(),
                                status: $('#status').val()
                            }),
                           success: function (response) {
                                 $('#editCompanyModal').modal('hide');
                                const $successMsg = $('#successMessage');
                                $successMsg.fadeIn(200);
                                setTimeout(() => {
                                    $successMsg.fadeOut(300, function () {
                                        $('body').removeClass('no-scroll');
                                        $successMsg.removeClass('show');
                                    });
                                    closeEditModal();
                                    if (typeof loadCompanies === 'function') {
                                        loadCompanies();
                                    }
                                }, 1500);
                                closeEditModal();
                            }
,
                            error: function (xhr) {

                            },
                            complete: function() {
                                        // Hide loading state
                                        $('#saveButton').prop('disabled', false);
                                        $('.loading-spinner').hide();
                                        $('#saveButton').text('Update Company');
                            }
                        });
                }else{
                    const formData = new FormData();
                    formData.append('companyName', $('#companyName').val().trim());
                    formData.append('subDomain', $('#subDomain').val().trim());
                    formData.append('addressName', $('#addressName').val().trim());
                    formData.append('city', $('#city').val().trim());
                    formData.append('state', $('#state').val().trim());
                    formData.append('country', $('#country').val().trim());
                    formData.append('email', $('#email').val().trim());
                    formData.append('phone', $('#phone').val().trim());
                    formData.append('status', $('#status').val());
                    formData.append('profilePic', profilePicFile);
                    $('#editCompanyModal').modal('hide');

                    $.ajax({
                        url: '/api/editCompanyWithProfile',
                        type: 'POST',
                        processData: false,
                        contentType: false,
                        headers: {
                            'Authorization': 'Bearer ' + getAccessToken()
                        },
                        data: formData,
                        success: function (response) {
                            const $successMsg = $('#successMessage');
                                $successMsg.fadeIn(200);
                                setTimeout(() => {
                                    $successMsg.fadeOut(300, function () {
                                        $('body').removeClass('no-scroll');
                                        $successMsg.removeClass('show');
                                    });
                                    closeEditModal();
                                    if (typeof loadCompanies === 'function') {
                                        loadCompanies();
                                    }
                                }, 1500);
                        },
                        error: function (xhr) {
                            console.error(xhr.responseText);
                        },
                        complete: function() {
                                        // Hide loading state
                                        $('#saveButton').prop('disabled', false);
                                        $('.loading-spinner').hide();
                                        $('#saveButton').text('Update Company');
                         }
                    });

                }


     });
      $(document).on('click', function(e) {
            if (e.target.id === 'editCompanyModal') {
                closeEditModal();
            }
        });
          $(document).on('keydown', function(e) {
            if (e.key === 'Escape' && $('#editCompanyModal').is(':visible')) {
                closeEditModal();
            }
        });
        $('#email').on('blur', function() {
            const email = $(this).val().trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (email && !emailRegex.test(email)) {
                $(this).siblings('.error-message').text('Please enter a valid email address').show();
                $(this).addClass('error');
            } else if (email) {
                $(this).siblings('.error-message').hide();
                $(this).removeClass('error');
            }
        });
       $('.form-input, .form-select').on('blur', function() {
            const element = $(this);
            const value = element.val().trim();

            if (element.prop('required') && !value) {
                element.siblings('.error-message').show();
                element.addClass('error');
            } else {
                element.siblings('.error-message').hide();
                element.removeClass('error');
            }
        });
     function deleteCompany(company) {
        showDeleteConfirmation(company);
     }
     function showDeleteConfirmation(company) {
        const confirmationModal = `
            <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-0 shadow-lg">
                        <div class="modal-header bg-danger text-white border-0" style="height:81px;">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <h5 class="modal-title mb-0" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
                            </div>
                          <button type="button" class="btn text-white position-absolute btn-close-custom"
                                      data-bs-dismiss="modal"
                                      aria-label="Close"
                                      style="top: 23px; right: 37px; background: transparent; border: none;">
                                  <i class="bi bi-x-lg" style="font-size:25px;"></i>
                              </button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="text-center mb-4">
                                <div class="warning-icon mb-3">
                                    <i class="fas fa-trash-alt text-danger" style="font-size: 3rem;"></i>
                                </div>
                                <h6 class="mb-3">Are you sure you want to delete this company?</h6>
                                <div class="company-info bg-light p-3 rounded mb-3">
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <strong class="text-primary">${company.companyName || 'N/A'}</strong>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <small class="text-muted">Domain:</small><br>
                                            <span class="small">${company.subDomain || 'N/A'}</span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted">Status:</small><br>
                                            <span class="badge ${company.status === 'Active' ? 'bg-success' : 'bg-danger'} small">
                                                ${company.status || 'N/A'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-warning d-flex align-items-center" role="alert">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <small>This action cannot be undone. All associated data will be permanently deleted.</small>
                                </div>
                            </div>
                        </div>
                        <div class="border-0 bg-light">
                            <div class="d-flex justify-content-between w-100">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-1"></i>
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" data-company-name="${company.companyName}">
                                    <i class="fas fa-trash me-1"></i>
                                    Yes, Delete Company
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Remove existing modal if present
        $('#deleteConfirmationModal').remove();

        // Add modal to body
        $('body').append(confirmationModal);

        // Show modal
        $('#deleteConfirmationModal').modal('show');

        // Handle confirm delete button click
        $('#confirmDeleteBtn').on('click', function() {
            const companyName = $(this).data('company-name');
            confirmDeleteCompany(companyName);
        });

        // Clean up modal when hidden
        $('#deleteConfirmationModal').on('hidden.bs.modal', function() {
            $(this).remove();
        });
     }

     function showLoadingIndicator() {
        $('#loadingSpinner').show();
        $('.btn').prop('disabled', true);
     }
     function hideLoadingIndicator() {
        $('#loadingSpinner').hide();
        $('.btn').prop('disabled', false);
        $('#loadingOverlay').remove();
     }
     function showDeleteLoadingState() {
        const loadingModal = `
            <div class="modal fade" id="deleteLoadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-dialog-centered modal-sm">
                    <div class="modal-content border-0">
                        <div class="modal-body text-center p-4">
                            <div class="spinner-border text-danger mb-3" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <h6 class="mb-2">Deleting Company...</h6>
                            <p class="text-muted small mb-0">Please wait while we process your request.</p>
                        </div>
                    </div>
                </div>
            </div>
        `;

        $('body').append(loadingModal);
        $('#deleteLoadingModal').modal('show');
     }

     // Function to hide loading state using jQuery
     function hideDeleteLoadingState() {
        $('#deleteLoadingModal').modal('hide');
        setTimeout(function() {
            $('#deleteLoadingModal').remove();
        }, 300);
     }
     function showDeleteSuccessMessage(companyName) {
        const successToast = `
            <div class="toast-container position-fixed top-0 end-0 p-3">
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
                    <div class="toast-header bg-success text-white">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong class="me-auto">Success</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        <strong>${companyName}</strong> has been successfully deleted.
                    </div>
                </div>
            </div>
        `;

        $('body').append(successToast);

        // Auto remove toast after 5 seconds
        setTimeout(function() {
            $('.toast-container').remove();
        }, 5000);
     }
     function showDeleteErrorMessage(errorMessage) {
        const errorToast = `
            <div class="toast-container position-fixed top-0 end-0 p-3">
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="7000">
                    <div class="toast-header bg-danger text-white">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong class="me-auto">Error</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        <strong>Failed to delete company:</strong><br>
                        <span class="text-muted">${errorMessage}</span>
                    </div>
                </div>
            </div>
        `;

        $('body').append(errorToast);

        // Auto remove toast after 7 seconds
        setTimeout(function() {
            $('.toast-container').remove();
        }, 7000);
     }
     function confirmDeleteCompany(companyName) {
        $('#deleteConfirmationModal').modal('hide');

        showLoadingIndicator();
        $.ajax({
            url: 'api/deleteCompany',
            type: 'POST',
            contentType: 'application/json',
            headers: {
                'Authorization': 'Bearer ' + getAccessToken(),
                'Content-Type': 'application/json'
            },
            data: JSON.stringify({
                companyName: companyName
            }),
            success: function(response) {
                hideLoadingIndicator();
                 hideDeleteLoadingState();
                showDeleteSuccessMessage(companyName);
                 loadCompanies();
            },
            error: function(xhr, status, error) {
                hideDeleteLoadingState();
                const errorMessage = xhr.responseJSON?.message || error || 'An error occurred while deleting the company';
                showDeleteErrorMessage(errorMessage);
            }
            });
      }
      function showErrorMessage(message) {
        const alertHtml = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        $('#alertContainer').html(alertHtml);
     }
     function viewCompany(companyName) {
      displayCompanyDetails(companyName);
     }
        // Helper function to display company details in a modal
     function displayCompanyDetails(company) {
        const modalContent = `
            <div class="modal fade" id="viewCompanyModal" tabindex="-1" aria-labelledby="viewCompanyModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered" >
                <div class="modal-content shadow-lg border-0">
                    <div class="modal-header bg-primary text-white border-0" style="height:81px;">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-building me-2"></i>
                            <h5 class="modal-title mb-0" id="viewCompanyModalLabel">Company Information</h5>
                        </div>
                          <button type="button" class="btn text-white position-absolute btn-close-custom"
                                      data-bs-dismiss="modal"
                                      aria-label="Close"
                                      style="top: 23px; right: 37px; background: transparent; border: none;">
                                  <i class="bi bi-x-lg" style="font-size:25px;"></i>
                              </button>
                        </div>
                    <div class="modal-body p-4">
                        <!-- Company Header -->
                    <!-- Company Header with Profile Pic -->
                    <div class="company-header mb-4 p-3 bg-light rounded">
                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                ${company.profilePicURL ? `
                                    <img src="${company.profilePicURL}" alt="Profile Pic" class="img-fluid rounded-circle shadow-sm" style="width: 70px; height: 70px; object-fit: cover;">
                                ` : `
                                    <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width: 70px; height: 70px;">
                                        <i class="fas fa-building text-white" style="font-size: 30px;"></i>
                                    </div>
                                `}
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-primary mb-1">${company.companyName || 'N/A'}</h6>
                                <p class="text-muted mb-0 small">
                                    <i class="fas fa-globe me-1"></i>
                                    ${company.subDomain || 'N/A'}
                                </p>
                            </div>
                            <div class="col-md-4 text-end">
                                <span class="badge ${company.status === 'Active' ? 'bg-success' : company.status === 'Inactive' ? 'bg-danger' : 'bg-warning'} px-3 py-2">
                                    <i class="fas fa-circle me-1" style="font-size: 0.7em;"></i>
                                    ${company.status || 'N/A'}
                                </span>
                            </div>
                        </div>
                    </div>


                        <!-- Company Details -->
                        <div class="row g-4">
                            <!-- Contact Information -->
                            <div class="col-md-6">
                                <div class="info-section">
                                    <h6 class="section-title text-secondary mb-3">
                                        <i class="fas fa-address-card me-2"></i>
                                        Contact Information
                                    </h6>
                                    <div class="info-item mb-3">
                                        <label class="form-label small text-muted mb-1">Email Address</label>
                                        <div class="info-value">
                                            <i class="fas fa-envelope text-primary me-2"></i>
                                            <span>${company.email || 'Not provided'}</span>
                                            ${company.email ? `<a href="mailto:${company.email}" class="ms-2 text-decoration-none small">
                                                <i class="fas fa-external-link-alt"></i>
                                            </a>` : ''}
                                        </div>
                                    </div>
                                    <div class="info-item mb-3">
                                        <label class="form-label small text-muted mb-1">Phone Number</label>
                                        <div class="info-value">
                                            <i class="fas fa-phone text-primary me-2"></i>
                                            <span>${company.phone || 'Not provided'}</span>
                                            ${company.phone ? `<a href="tel:${company.phone}" class="ms-2 text-decoration-none small">
                                                <i class="fas fa-external-link-alt"></i>
                                            </a>` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Location Information -->
                            <div class="col-md-6">
                                <div class="info-section">
                                    <h6 class="section-title text-secondary mb-3">
                                        <i class="fas fa-map-marker-alt me-2"></i>
                                        Location Details
                                    </h6>
                                    <div class="info-item mb-3">
                                        <label class="form-label small text-muted mb-1">Address</label>
                                        <div class="info-value">
                                            <i class="fas fa-map-pin text-primary me-2"></i>
                                            <span>${company.addressName || 'Not provided'}</span>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">
                                            <div class="info-item mb-2">
                                                <label class="form-label small text-muted mb-1">City</label>
                                                <div class="info-value small">
                                                    <span>${company.city || 'N/A'}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="info-item mb-2">
                                                <label class="form-label small text-muted mb-1">State</label>
                                                <div class="info-value small">
                                                    <span>${company.state || 'N/A'}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="info-item mb-2">
                                                <label class="form-label small text-muted mb-1">Country</label>
                                                <div class="info-value small">
                                                    <span>${company.country || 'N/A'}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Info Section -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="additional-info p-3 bg-light rounded">
                                    <div class="row text-center">
                                        <div class="col-md-4">
                                            <div class="stat-item">
                                                <i class="fas fa-calendar-alt text-primary mb-2 d-block"></i>
                                                <small class="text-muted">Created</small>
                                                <div class="fw-bold">${company.createdDate || 'N/A'}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="stat-item">
                                                <i class="fas fa-edit text-primary mb-2 d-block"></i>
                                                <small class="text-muted">Last Updated</small>
                                                <div class="fw-bold">${company.updatedDate || 'N/A'}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="stat-item">
                                                <i class="fas fa-users text-primary mb-2 d-block"></i>
                                                <small class="text-muted">Employees</small>
                                                <div class="fw-bold">${company.employeeCount || 'N/A'}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 bg-light">
                        <div class="d-flex justify-content-between w-100">
                            <div class="btn-group">
                                <button type="button" class="btn btn-outline-success btn-sm" onclick="exportCompany('${company.id}')">
                                    <i class="fas fa-download me-1"></i>
                                    Export
                                </button>
                            </div>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-1"></i>
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        `;

        // Remove existing modal if any
        const existingModal = document.getElementById('viewCompanyModal');
        if (existingModal) {
            existingModal.remove();
        }

        // Add modal to body
        document.body.insertAdjacentHTML('beforeend', modalContent);

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('viewCompanyModal'));
        modal.show();
     }
  </script>
</th:block>